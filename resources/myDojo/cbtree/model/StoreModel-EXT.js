//>>built
define("cbtree/model/StoreModel-EXT",["module","dojo/_base/lang","dojo/when","./_base/BaseStoreModel","./_base/Parents","../errors/createError!../errors/CBTErrors.json","../util/QueryEngine"],function(_1,_2,_3,_4,_5,_6,_7){var _8=_6(_1.id);function _9(_a){return (Object.prototype.toString.call(_a)=="[object Object]");};var _b={_checkOrUncheck:function(_c,_d,_e,_f){var _10=this.checkedStrict?true:false,_11=0,_12=0;this.fetchItemsWithChecked(_c,function(_13){_13.forEach(function(_14){if(_14[this.checkedAttr]!=_d){this.setChecked(_14,_d);_12+=1;}_11+=1;},this);if(_e){_e.call((_f||this),_11,_12);}},this,_10);},fetchItem:function(_15,_16,_17){var _18=this._anyToQuery(_15,null);_17=_17||this;if(_18&&_16){_3(this.store.query(_18),function(_19){var _1a=Array.prototype.slice.call(_19);_16.call(_17,(_1a.length?_1a[0]:undefined));});}},fetchItemsWithChecked:function(_1b,_1c,_1d,_1e){var _1f=this._anyToQuery(_1b,null);var _20=[];var _21=(_1e!==undefined)?!!_1e:true;var _22=this;_1d=_1d||this;if(_9(_1f)){_3(this.store.query(_1f,{cacheOnly:_21}),function(_23){_23.forEach(function(_24){if(_22.checkedAttr in _24){_20.push(_24);}else{if(_22.checkedAll){_22.setChecked(_24,this.checkedState);_20.push(_24);}}});if(_1c){_1c.call(_1d,_20);}},this.onError);}else{throw new _8("InvalidObject","fetchItemsWithChecked","query must be of type object");}},isRootItem:function(_25){return this.isChildOf(_25,this.root);},check:function(_26,_27,_28,_29){this._checkOrUncheck(_26,true,_27,_28,_29);},uncheck:function(_2a,_2b,_2c,_2d){this._checkOrUncheck(_2a,false,_2b,_2c,_2d);},_changeParents:function(_2e,_2f,_30){var _31,_32=this;if(_2e&&_2f){var _33=this.getIdentity(_2f);var _34=this.getIdentity(_2e);var _35=(this._forest&&this.root.id==_34);if(_34&&_33&&!_35){_3(this.store.get(_34),function(_36){if(_36){var _37=_32.isChildOf(_36,_32.root);var _38=new _5(_36,_32.parentProperty);var _39=(_32._forest&&_32.root.id==_33);if(_39){if(!_38.multiple){_36[_32.parentProperty]=undefined;this.store.put(_36);}if((!_37&&_30=="attach")||(_37&&_30=="detach")){var _3a=_32._updateChildrenCache(_30,_2f,_2e);_3(_3a,function(){_32.onRootChange(_2e,_30);_32._childrenChanged(_32.root);});}}else{if(_38[_30](_33)){_36[_32.parentProperty]=_38.toValue();_34=_32.store.put(_36);if(!_32._monitored){_3(_34,function(){_32._childrenChanged(_2f);});}}}}else{throw new _8("InvalidObject","addParent","Item ["+_34+"] is not a valid store item");}});}}},addParent:function(_3b,_3c){if(typeof _3c=="string"){var _3d=this;_3(this.store.get(_3c),function(_3e){_3d._changeParents(_3b,_3e,"attach");});}else{this._changeParents(_3b,_3c,"attach");}},removeParent:function(_3f,_40){if(typeof _40=="string"){var _41=this;_3(this.store.get(_40),function(_42){_41._changeParents(_3f,_42,"detach");});}else{this._changeParents(_3f,_40,"detach");}},_anyToQuery:function(_43,_44){var _45=this.store.idProperty;if(_45){var _46=_44||_45,_47={};if(typeof _43=="string"){_47[_45]=_43;}else{if(_43&&_9(_43)){_2.mixin(_47,_43);if(_46 in _43){_47[_45]=_43[_46];}}else{_47[_45]=/.*/;}}return _47;}return null;}};_4.extend(_b);return true;});