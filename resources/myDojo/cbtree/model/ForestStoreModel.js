//>>built
define("cbtree/model/ForestStoreModel",["module","dojo/_base/declare","dojo/_base/lang","dojo/Deferred","dojo/when","./_base/CheckedStoreModel","../errors/createError!../errors/CBTErrors.json"],function(_1,_2,_3,_4,_5,_6,_7){var _8=_7(_1.id);var _9=_2([_6],{rootId:"$root$",rootLabel:"ROOT",constructor:function(_a){var _b={id:this.rootId,root:true};var _c=this.store;var _d=this;_b[this.checkedAttr]=this.checkedState;_b[this.labelAttr]=this.rootLabel||this.rootId;if(this._methods.queryEngine){this._rootQuery=_c.queryEngine(this.query);}else{throw new _8("MethodMissing","_createForestRoot","store has no query engine");}this._forest=true;this.root=_b;},getChildren:function(_e,_f,_10){this._getChildren(_e,function(_11,id){return ((_11==this.root)?this.store.query(this.query,this.options):this.store.getChildren(_11,this.options));},_f,_10);},getParents:function(_12){if(_12&&_12!=this.root){var _13=this.inherited(arguments);var _14=this;return _13.then(function(_15){if(_14.isChildOf(_12,_14.root)){_15.push(_14.root);}return _15;});}else{var _16=new _4();return _16.resolve([]);}},mayHaveChildren:function(_17){if(_17&&_17==this.root){var _18=this.getIdentity(_17);return !!this._childrenCache[_18];}return this.inherited(arguments);},getIdentity:function(_19){return (_19==this.root?this.root.id:this.store.getIdentity(_19));},isChildOf:function(_1a,_1b){if(_1b&&_1a){if(_1b==this.root){return (this._rootQuery.matches?this._rootQuery.matches(_1a):!!this._rootQuery([_1a]).length);}return this.inherited(arguments);}return false;},_setValue:function(_1c,_1d,_1e){if(_1c[_1d]!==_1e){if(_1c==this.root){var _1f=_3.mixin(null,_1c);_1c[_1d]=_1e;this._onChange(_1c,_1f);}else{this.inherited(arguments);}}return _1e;},_onSetItem:function(_20,_21,_22,_23){if(this.query&&_21 in this.query){var _24=this;_5(this._childrenCache[this.root.id],function(_25){var _26=_25?_25.indexOf(_20):-1;var _27=_24.isChildOf(_20,_24.root);var _28=(_26>-1);if(_27!=_28){var _29=_27?"attach":"detach";var _25=_24._updateChildrenCache(_29,_24.root,_20);_5(_25,function(){_24.onRootChange(_20,_29);_24._childrenChanged(_24.root);});}});}this.inherited(arguments);},toString:function(){return "[object ForestStoreModel]";}});return _9;});