//>>built
define("cbtree/models/ForestStoreModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","./TreeStoreModel"],function(_1,_2,_3,_4,_5){return _2([_5],{rootLabel:"ROOT",rootId:"$root$",moduleName:"cbTree/models/ForestStoreModel",constructor:function(_6){this.root={store:this,root:true,id:this.rootId,label:this.rootLabel,children:_6.rootChildren};this.root[this.checkedAttr]=this.checkedState;this.hasFakeRoot=true;},getChildren:function(_7,_8,_9,_a){if(_7===this.root){if(this.root.children){_8(this.root.children);}else{this.store.fetch(this._mixinFetch({query:this.query,onComplete:_3.hitch(this,function(_b){this.root.children=_b;_8(_b);}),onError:_9}));}}else{this.inherited(arguments);}},getParents:function(_c){var _d=[];if(_c){if(_c!==this.root){_d=this.store.getParents(_c);if(!_d.length){return [this.root];}}return _d;}},mayHaveChildren:function(_e){return _e===this.root||this.inherited(arguments);},fetchItemByIdentity:function(_f){if(_f.identity==this.root.id){var _10=_f.scope?_f.scope:_4.global;if(_f.onItem){_f.onItem.call(_10,this.root);}}else{this.inherited(arguments);}},getIcon:function(_11){if(this.iconAttr){if(_11!==this.root){return this.store.getValue(_11,this.iconAttr);}return this.root[this.iconAttr];}},getIdentity:function(_12){return (_12===this.root)?this.root.id:this.inherited(arguments);},getLabel:function(_13){return (_13===this.root)?this.root.label:this.inherited(arguments);},isItem:function(_14){return (_14===this.root)?true:this.inherited(arguments);},isChildOf:function(_15,_16){if(_15===this.root){if(_1.indexOf(this.root.children,_16)!==-1){return true;}}else{return this.inherited(arguments);}},deleteItem:function(_17){if(_17===this.root){var _18=this.root.children||[];var i;for(i=0;i<_18.length;i++){this.store.deleteItem(_18[i]);}}else{return this.store.deleteItem(_17);}},newItem:function(_19,_1a,_1b,_1c){if(_1a===this.root){var _1d=this.store.newItem(_19);this._updateCheckedParent(_1d);return _1d;}else{return this.inherited(arguments);}},pasteItem:function(_1e,_1f,_20,_21,_22,_23){if(_1f===this.root){if(!_21){this.store.detachFromRoot(_1e);}}if(_20===this.root){this.store.attachToRoot(_1e,_22);}this.inherited(arguments,[_1e,_1f===this.root?null:_1f,_20===this.root?null:_20,_21,_22,_23]);},onDeleteItem:function(_24){if(_1.indexOf(this.root.children,_24)!=-1){this._requeryTop();}this.inherited(arguments);},onNewItem:function(_25,_26){if(_26){this.getChildren(_26.item,_3.hitch(this,function(_27){this.onChildrenChange(_26.item,_27);}));this._updateCheckedParent(_25,true);}else{this._requeryTop();}},onSetItem:function(_28,_29,_2a,_2b){if(this._queryAttrs.length&&_1.indexOf(this._queryAttrs,_29)!=-1){this._requeryTop();}this.inherited(arguments);},onRootChange:function(_2c,_2d){if(_2d==="attach"||_2d==="detach"){this._requeryTop();}},_requeryTop:function(){var _2e=this.root.children||[];this.store.fetch(this._mixinFetch({query:this.query,onComplete:_3.hitch(this,function(_2f){this.root.children=_2f;if(_2e.length!=_2f.length||_1.some(_2e,function(_30,idx){return _2f[idx]!=_30;})){this.onChildrenChange(this.root,_2f);this._updateCheckedParent(_2f[0]);}})}));}});});