//>>built
define("cbtree/models/FileStoreModel",["dojo/_base/array","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/aspect","./TreeStoreModel"],function(_1,_2,_3,_4,_5,_6){return _2([_6],{deferItemLoadingUntilExpand:true,queryOptions:null,sort:null,rootLabel:"ROOT",rootId:"$rootDir$",moduleName:"cbTree/models/FileStoreModel",constructor:function(_7){var _8=this.store;this.root={store:this,root:true,id:this.rootId,label:this.rootLabel,children:_7.rootChildren};this.root[this.checkedAttr]=this.checkedState;this.hasFakeRoot=true;this._validateStore=false;if(_7.queryOptions){this._setQueryOptions(_7.queryOptions);}if(_7.sort){this._setSortFields(_7.sort);}if(_8.getFeatures()["dojo.data.api.Notification"]){this.connects=this.connects.concat([_5.after(_8,"onClose",_3.hitch(this,"onStoreClose"),true)]);}console.warn("cbTree/models/FileStoreModel has been deprecated and will be removed with dojo 2.0 !!");},_setQueryOptions:function(_9){if(_3.isObject(_9)){this.queryOptions=_9;}},_setSortFields:function(_a){if(_3.isArray(_a)){var _b=true;_1.forEach(_a,function(_c){if(!_3.isObject(_c)){_b=false;}});if(_b){this.sort=_a;}}},getChildren:function(_d,_e,_f){var _10=this.store;var _11=this;if(_d===this.root){if(this.root.children){_e(this.root.children);}else{this.store.fetch({query:this.query,queryOptions:this.queryOptions,sort:this.sort,onComplete:_3.hitch(this,function(_12){this.root.children=_12;_e(_12);}),onError:_f});}}else{_10.fetchChildren({item:_d,query:this.query,queryOptions:this.queryOptions,sort:this.sort,onError:_f,scope:_11,onComplete:function(_13){_e(_13);}});}return;},getParents:function(_14){var _15=[];if(_14){if(_14!==this.root){_15=this.store.getParents(_14);if(!_15.length){return [this.root];}}return _15;}},mayHaveChildren:function(_16){return _16===this.root||this.inherited(arguments);},fetchItemByIdentity:function(_17){if(_17.identity==this.root.id){var _18=_17.scope?_17.scope:_4.global;if(_17.onItem){_17.onItem.call(_18,this.root);}}else{this.inherited(arguments);}},getIcon:function(_19){if(this.iconAttr){if(_19!==this.root){return this.store.getValue(_19,this.iconAttr);}return this.root[this.iconAttr];}},getIdentity:function(_1a){return (_1a===this.root)?this.root.id:this.inherited(arguments);},getLabel:function(_1b){return (_1b===this.root)?this.root.label:this.inherited(arguments);},isItem:function(_1c){return (_1c===this.root)?true:this.inherited(arguments);},isChildOf:function(_1d,_1e){if(_1d===this.root){if(_1.indexOf(this.root.children,_1e)!==-1){return true;}}else{return this.inherited(arguments);}},deleteItem:function(_1f,_20,_21,_22,_23){var _23=_23||window.global;if(_1f===this.root){var _24=this.root.children||[];var i;if(_24.length>0){if(_20){if(!_20.call(_23,_1f)){return;}}for(i=0;i<_24.length;i++){this.store.deleteItem(_24[i],null,_21,_22,_23);}}}else{return this.store.deleteItem(_1f,_20,_21,_22,_23);}},newItem:function(_25,_26,_27,_28){throw new Error(this.moduleName+"::newItem(): Operation not allowed on a File Store.");},pasteItem:function(_29,_2a,_2b,_2c,_2d,_2e){var _2f="",_30="";if(this.store.isItem(_29)){_30=this.store.getDirectory(_29);if(_2b!==this.root){if(_2b.directory){_2f=this.store.getPath(_2b);}else{_2f=this.store.getDirectory(_2b);}}if(_30!==_2f){var _31=_2f+"/"+this.store.getLabel(_29);this.store.renameItem(_29,_31);}}},onDeleteItem:function(_32){if(_1.indexOf(this.root.children,_32)!=-1){this._requeryTop();}this.inherited(arguments);},onNewItem:function(_33,_34){if(_34){this.getChildren(_34.item,_3.hitch(this,function(_35){this.onChildrenChange(_34.item,_35);}));this._updateCheckedParent(_33,true);}else{this._requeryTop();}},onSetItem:function(_36,_37,_38,_39){if(this._queryAttrs.length&&_1.indexOf(this._queryAttrs,_37)!=-1){this._requeryTop();}this.inherited(arguments);},onStoreClose:function(_3a){},_requeryTop:function(){var _3b=this.root.children||[];this.store.fetch({query:this.query,queryOptions:this.queryOptions,sort:this.sort,onComplete:_3.hitch(this,function(_3c){this.root.children=_3c;if(_3b.length!=_3c.length||_1.some(_3b,function(_3d,idx){return _3c[idx]!=_3d;})){this.onChildrenChange(this.root,_3c);this._updateCheckedParent(_3c[0],true);}})});}});});