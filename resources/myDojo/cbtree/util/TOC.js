//>>built
define("cbtree/util/TOC",["module","dojo/_base/declare","dojo/_base/lang","dijit/Destroyable","dijit/registry","dijit/tree/dndSource","../Evented","../Tree","../extensions/TreeStyling","../model/TreeStoreModel","../store/ObjectStore","../store/extensions/Ancestry","../errors/createError!../errors/CBTErrors.json","./QueryEngine","./shim/Array"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){var _f=_d(_1.id);var _10;function _11(_12,_13){function _14(_15){var _16=_15.getParent();if(_16&&_16!=_15.tree.rootNode){return _14(_16);}return _15;};function _17(_18,_19){var _1a=_18.getChildren();return _1a.some(function(_1b){if(_1b!=_19){return _17(_1b,_19);}return true;});};var _1c=_14(_12);return _17(_1c,_13);};var TOC=_2([_4,_7],{checked:false,model:null,name:"Table Of Content",store:null,tree:null,constructor:function(_1d,_1e){var toc=this;_2.safeMixin(this,_1d);var _1f={id:"ROOT",name:this.name,type:"ROOT"};this.store=new _b({data:[_1f]});this.model=new _a({store:this.store,enabledAttr:"enabled",query:{type:"ROOT"},checkedAll:false});this.tree=new _8({model:this.model,checkItemAcceptance:this._acceptEntry,clickEventCheckBox:false,dndController:_6,betweenThreshold:5,openOnDblClick:this.openOnDblClick||false,openOnClick:this.openOnClick||false,valueToIconMap:this.valueToIconMap||null,enableDelete:this.enableDelete||false,deleteRecursive:this.deleteRecursive||false,persist:false,showRoot:true},_1e);this.own(this.tree.on("checkBoxClick",function(){toc.onCheckBoxClick.apply(toc,arguments);}),this.tree.on("Dblclick",function(){toc.onDblClick.apply(arguments);}),this.tree.on("click",function(){toc.onClick.apply(toc,arguments);}),this.model.on("pasteItem",function(){toc.onMoved(toc,arguments);}),this.model.on("delete",function(){toc.onDelete.apply(toc,arguments);}));},destroy:function(){this.inherited(arguments);this.store.destroy();this.model.destroy();this.tree.destroy();},_acceptEntry:function(_20,_21){var _22=_5.getEnclosingWidget(_20),_23=_22.tree,_24=_23.model.store,_25=_21.tree;var _26;if(_25!=_23||_22==_23.rootNode){return false;}for(_26 in _21.selection){var _27=_21.selection[_26];var _28=_24.getIdentity(_27.item);if(!_11(_22,_27)){return false;}}return true;},_getIdentity:function(_29){if({}.toString.call(_29)=="[object Object]"){return this.store.getIdentity(_29);}else{if(typeof _29=="string"||typeof _29=="number"){return _29;}}},_makeEntry:function(_2a,_2b){if(_2a&&_2a.name){if(_2a.id&&(typeof _2a.id!="string"&&typeof _2a.id!="number")){throw new _f("InvalidProperty","_makeEntry","Property: id");}var _2c=(_2b&&_2b.checkbox)||true;var _2d=(_2b&&_2b.readOnly)||false;var _2e=this.store.get(_2b.parent);if(_2e){if(_2c){_2a.checked=this.checked;_2a.enabled=!_2d;}_2b.parent=_2e;return _2a;}throw new _f("NotFound","_makeEntry","Parent object not found");}throw new _f("InvalidProperty","_makeEntry","Property: name");},addHeader:function(_2f,_30){if(_2f&&_2f.id){var _31=this._getIdentity(_30&&_30.parent)||"ROOT";_30=_3.mixin(_30,{parent:_31});_2f=this._makeEntry(_2f,_30);_2f.type="HEADER-"+this.store.getAncestors(_30.parent).length;var _32=this.store.add(_2f,{parent:_30.parent});return this.get(_32);}throw new _f("PropertyMissing","addHeader");},addEntry:function(_33,_34){if(_33&&_33.type){var _35=this._getIdentity(_34&&_34.parent)||null;_34=_3.mixin(_34,{parent:_35});_33=this._makeEntry(_33,_34);var _36=this.store.add(_33,{parent:_34.parent});return this.get(_36);}},get:function(id){return this.store.get(id);},getChildren:function(_37){return this.store.getChildren(_37);},getChecked:function(_38){return this.model.getChecked(_38);},getDescendants:function(_39,_3a){var _3b=this.store.getDescendants(_39);if(_3b&&_3a){_3b=_e(_3a)(_3b);}return _3b;},query:function(_3c,_3d){return this.store.query(_3c,_3d);},setChecked:function(_3e,_3f){return this.model.setChecked(_3e,!!_3f);},startup:function(){this.tree.startup();},toString:function(){return "[object TOC]";},onCheckBoxClick:function(){},onClick:function(){},onDblClick:function(){},onDelete:function(){},onMoved:function(){}});return TOC;});