//>>built
define("cbtree/store/Eventable",["dojo/_base/lang","dojo/Deferred","dojo/when","../util/Mutex","../Evented"],function(_1,_2,_3,_4,_5){var _6=function(_7){var _8={};var _9=new _4();if(typeof _7.emit=="function"){if(_7.eventable===true){return _7;}}_7=_1.delegate(_7,new _5());_7.eventable=true;function _a(_b,_c){if(_7[_b]&&typeof _7[_b]==="function"){_8[_b]=_7[_b];_7[_b]=_c;}};_a("add",function(_d,_e){var _f=_8["add"].apply(_7,arguments);_3(_f,function(id){if(id){_7.emit("new",{type:"new",detail:{item:_d}});}},_9.onError);return _f;});_a("put",function(_10,_11){var _12=arguments;return _9.aquire(function(){_3(_7.get(_7.getIdentity(_10)),function(_13){var _14=_1.mixin(null,_13);var _15=_8["put"].apply(_7,_12);_3(_15,function(id){_9.release(id);if(_13){_7.emit("change",{type:"change",detail:{item:_10,oldItem:_14}});}else{_7.emit("new",{type:"new",detail:{item:_10}});}},_9.onError);},function(err){var _16=_8["put"].apply(_7,_12);_3(_16,function(id){_9.release(id);_7.emit("new",{type:"new",detail:{item:_10}});},_9.onError);});});});_a("remove",function(id,_17){var _18=arguments;return _9.aquire(function(){_3(_7.get(id),function(_19){var _1a=_19?_1.mixin({},_19):null;var _1b=_8["remove"].apply(_7,_18);_3(_1b,function(_1c){_9.release(_1c);if(_1a){_7.emit("delete",{type:"delete",detail:{item:_1a}});}});},_9.onError);});});return _7;};return _6;});