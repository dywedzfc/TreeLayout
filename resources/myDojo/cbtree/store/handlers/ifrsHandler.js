//>>built
define("cbtree/store/handlers/ifrsHandler",["dojo/_base/lang","dojo/date/stamp","dojo/json","../../util/shim/Array"],function(_1,_2,_3){"use strict";var _4="cbtree/store/handlers/ifrsHandler";function _5(_6){return (Object.prototype.toString.call(_6)=="[object Object]");};function _7(_8){return (Object.prototype.toString.call(_8)=="[object Function]");};function _9(_a){this.childProperty=["children"];this.parentProperty="parent";this.idProperty="id";this.referenceToId=true;this.typeMap={};var _b=this;this.handler=function(_c){var _d=_b.parentProperty;var _e=_b.childProperty;var _f=_b.idProperty;var _10=_b.typeMap;var _11=_b.referenceToId;var _12=1;var _13=[];var _14=[];var _15={};var _16;var _17=0;function _18(_19,_1a){var _1b;if(_19){var _1b=_1c(_19,false);if(_1b){var _1d=_1b[_f];var _1e=_1b[_d];if(_1e){_1e.push(_1a);}else{_1e=[_1a];}_1b[_d]=_1e;_17=Math.max(_1e.length,_17);}}};function _1f(_20){var _21=_20[_f];var _22;if(_21){if(typeof _21=="number"&&_21>_12){_12=Math.floor(_21+1);}}else{_21=_12++;}_20[_f]=_21;_15[_21]=_20;_13.push(_20);for(_22 in _20){if(_e.indexOf(_22)!=-1){var _23=_20[_22];if(_23&&_23 instanceof Array){_23.forEach(function(_24){if(_5(_24)&&!_24._reference){_24[_d]=_21;_1f(_24);}});}}}};function _1c(_25,_26){var _27;if(_5(_25)){_27=_13.filter(function(_28){for(var _29 in _25){if(_28[_29]!=_25[_29]){return false;}}return true;})[0];}else{if(!(_27=_15[_25])){if(_14.indexOf(_25)==-1){_14.push(_25);}}}return (_27&&_26)?_27[_f]:_27;};function _2a(_2b,_2c){if(_10){var _2d=_10[_2b];if(_2d){if(_7(_2d)){return new _2d(_2c);}if(_5(_2d)){var _2e=_2d.deserialize;var _2f=_2d.type;if(_7(_2e)){return _2e(_2c);}if(_7(_2f)){return new _2f(_2c);}}}throw new TypeError(_4+"::handler::mapType(): constructor missing for datatype: ["+_2b+"]");}throw new TypeError(_4+"::handler::mapType(): custom type detected but no mapping table available");};function _30(_31){var _32=_31[_f];var _33;for(_33 in _31){var _34=_31[_33];if(_34){if(_d&&_e.indexOf(_33)!=-1){if(_34 instanceof Array){_34.forEach(function(_35){if(_35._reference){_18(_35._reference,_32);}});}delete _31[_33];continue;}if(_34 instanceof Array){_34=_34.map(function(_36){if(_5(_36)){if(_36._reference){return _1c(_36._reference,_11);}else{if(_36._type){return _2a(_36._type,_36._value);}}}return _36;});_31[_33]=_34.filter(function(_37){return !!_37;});}else{if(_5(_34)){if(_34._reference){_31[_33]=_1c(_34._reference,_11);}else{if(_34._type){_31[_33]=_2a(_34._type,_34._value);}}}}}}};_16=_3.parse(_c.text||_c.data);if(_16&&_16.items){var _f=_16.identifier||_f;_16.items.forEach(_1f);_13.forEach(_30);if(_17==1){_13.forEach(function(_38){_38[_d]=_38[_d]?_38[_d][0]:undefined;});}if(_14.length>0){console.warn("Undefined references: "+_14);}}else{throw new TypeError(_4+"::handler(): invalid IFRS file format");}return _13;};this.set=function(_39,_3a){if(_39){if(_5(_39)){for(var key in _39){this.set(key,_39[key]);}}this[_39]=_3a;}this.childProperty=this.childProperty instanceof Array?this.childProperty:[this.childProperty];this.typeMap=this.typeMap||{};if(!this.typeMap["Date"]){this.typeMap["Date"]={type:Date,deserialize:function(_3b){return _2.fromISOString(_3b);}};}};if(_a){this.set(_a);}};return _9;});