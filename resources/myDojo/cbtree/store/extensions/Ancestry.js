//>>built
define("cbtree/store/extensions/Ancestry",["./_Path","./_PathList","../Natural","../Hierarchy"],function(_1,_2,_3,_4){"use strict";function _5(_6,_7){var _8=_6.getIdentity(_7);var _9=[];var _a={};if(_6.indexChildren){_9=(_6._indexChild[_8]||[]).slice(0);}else{_a[_6.parentProperty]=_8;_9=_6.query(_a);}return _9;};function _b(o){for(var _c in o){if(o.hasOwnProperty(_c)){return false;}}return true;};var _d={analyze:function(_e){var _f=_e>0?_e:0;var _10=this._data||[];var _11=0;var _12={};_10.some(function(_13){var _14=this._getParentArray(_13);var _15=_14.filter(function(_16){return !this.get(_16);},this);_15.forEach(function(_17){var ref,_18=this.getIdentity(_13);if(ref=_12[_17]){ref.push(_18);}else{ref=[_18];_11++;}_12[_17]=ref;},this);return (_f&&_f<=_11);},this);return !_b(_12)?_12:null;},getAncestors:function(_19,_1a){function _1b(_1c,_1d,_1e){_1c.getParents(_1d).forEach(function(_1f){if(_1e.indexOf(_1f)==-1){_1e.push(_1f);_1b(_1c,_1f,_1e);}});return _1e;};var _19=this._anyToObject(_19);if(_19){var _20=_1b(this,_19,[]);if(_1a===true){_20=_20.map(this.getIdentity,this);}return _20;}},getDescendants:function(_21,_22){function _23(_24,_25,_26){_5(_24,_25).forEach(function(_27){if(_26.indexOf(_27)==-1){_26.push(_27);_23(_24,_27,_26);}});return _26;};var _21=this._anyToObject(_21);if(_21){var _28=_23(this,_21,[]);if(_22===true){_28=_28.map(this.getIdentity,this);}return _28;}},getPaths:function(_29,_2a){var _29=this._anyToObject(_29);var _2b=_2a||"/";var _2c=this;function _2d(_2e,_2f,_30){var _31=_2c.getParents(_2e);if(_31.length){_31.forEach(function(_32){var _33=_2c.getIdentity(_32)+_2b+_2f;_30=_2d(_32,_33,_30);});}else{_30=_30||new _2();_30.push(new _1(_2f,_2b));}return _30;};if(_29){var _34=_2d(_29,this.getIdentity(_29),null);return _34;}},getSiblings:function(_35,_36){var _35=this._anyToObject(_35);var _37=[];if(_35){this.getParents(_35).forEach(function(_38){_5(this,_38).forEach(function(_39){if(_39!=_35&&_37.indexOf(_39)==-1){_37.push(_39);}});},this);if(_36===true){_37=_37.map(this.getIdentity,this);}return _37;}},isAncestorOf:function(_3a,_3b){function _3c(_3d,_3e,_3f){var gps=_3d.getParents(_3f);if(gps.indexOf(_3e)==-1){return gps.some(function(gp){return _3c(_3d,_3e,gp);},this);}return true;};var _3a=this._anyToObject(_3a);var _3b=this._anyToObject(_3b);if(_3b&&_3a){return _3c(this,_3a,_3b);}return false;},isChildOf:function(_40,_41){var _41=this._anyToObject(_41);var _40=this._anyToObject(_40);if(_41&&_40){var _42=this._getParentArray(_40);var _43=this.getIdentity(_41);return (_42.indexOf(_43)!=-1);}return false;},isDescendantOf:function(_44,_45){return this.isAncestorOf(_45,_44);},isSiblingOf:function(_46,_47){var _47=this._anyToObject(_47);var _46=this._anyToObject(_46);var _48=this.getSiblings(_47);if(_48){return (_48.indexOf(_46)!=-1);}return false;}};var _49={isBefore:function(_4a,_4b){var _4c=this._anyToObject(_4a);var _4d=this._anyToObject(_4b);if(_4c&&_4d){var _4e=this._data.indexOf(_4c);var _4f=this._data.indexOf(_4d);return (_4e<_4f);}return false;}};_4.extend(_d);_3.extend(_49);return true;});