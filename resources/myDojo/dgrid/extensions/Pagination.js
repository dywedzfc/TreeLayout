//>>built
define("dgrid/extensions/Pagination",["../_StoreMixin","dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/dom-construct","dojo/dom-class","dojo/on","dojo/query","dojo/string","dojo/has","dojo/when","../util/misc","dojo/i18n!./nls/pagination","dojo/_base/sniff"],function(_1,_2,_3,_4,_5,_6,on,_7,_8,_9,_a,_b,_c){function _d(_e){if(_e.noDataNode){_5.destroy(_e.noDataNode);delete _e.noDataNode;}else{_e.cleanup();}_e.contentNode.innerHTML="";};function _f(_10){if(_10.loadingNode){_5.destroy(_10.loadingNode);delete _10.loadingNode;}else{if(_10._oldPageNodes){for(var id in _10._oldPageNodes){_10.removeRow(_10._oldPageNodes[id]);}delete _10._oldPageNodes;}}delete _10._isLoading;};return _2(_1,{rowsPerPage:10,pagingTextBox:false,previousNextArrows:true,firstLastArrows:false,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:true,i18nPagination:_c,showFooter:true,_currentPage:1,buildRendering:function(){this.inherited(arguments);var _11=this,_12=this.paginationNode=_5.create("div",{className:"dgrid-pagination"},this.footerNode),_13=this.paginationStatusNode=_5.create("div",{className:"dgrid-status"},_12),_c=this.i18nPagination,_14,_15;_13.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();this._updatePaginationStatus(this._total);_14=this.paginationNavigationNode=_5.create("div",{className:"dgrid-navigation"},_12);if(this.firstLastArrows){_15=this.paginationFirstNode=_5.create("span",{"aria-label":_c.gotoFirst,className:"dgrid-first dgrid-page-link",innerHTML:"«",tabIndex:0},_14);}if(this.previousNextArrows){_15=this.paginationPreviousNode=_5.create("span",{"aria-label":_c.gotoPrev,className:"dgrid-previous dgrid-page-link",innerHTML:"‹",tabIndex:0},_14);}this.paginationLinksNode=_5.create("span",{className:"dgrid-pagination-links"},_14);if(this.previousNextArrows){_15=this.paginationNextNode=_5.create("span",{"aria-label":_c.gotoNext,className:"dgrid-next dgrid-page-link",innerHTML:"›",tabIndex:0},_14);}if(this.firstLastArrows){_15=this.paginationLastNode=_5.create("span",{"aria-label":_c.gotoLast,className:"dgrid-last dgrid-page-link",innerHTML:"»",tabIndex:0},_14);}this._listeners.push(on(_14,".dgrid-page-link:click,.dgrid-page-link:keydown",function(_16){if(_16.type==="keydown"&&_16.keyCode!==13){return;}var cls=this.className,_17,max;if(_11._isLoading||cls.indexOf("dgrid-page-disabled")>-1){return;}_17=_11._currentPage;max=Math.ceil(_11._total/_11.rowsPerPage);if(this===_11.paginationPreviousNode){_11.gotoPage(_17-1);}else{if(this===_11.paginationNextNode){_11.gotoPage(_17+1);}else{if(this===_11.paginationFirstNode){_11.gotoPage(1);}else{if(this===_11.paginationLastNode){_11.gotoPage(max);}else{if(cls==="dgrid-page-link"){_11.gotoPage(+this.innerHTML);}}}}}}));},destroy:function(){this.inherited(arguments);if(this._pagingTextBoxHandle){this._pagingTextBoxHandle.remove();}},_updatePaginationSizeSelect:function(){var _18=this.pageSizeOptions,_19=this.paginationSizeSelect,_1a;if(_18&&_18.length){if(!_19){_19=this.paginationSizeSelect=_5.create("select",{"aria-label":this.i18nPagination.rowsPerPage,className:"dgrid-page-size"},this.paginationNode);_1a=this._paginationSizeChangeHandle=on(_19,"change",_4.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value);}));this._listeners.push(_1a);}_19.options.length=0;for(var i=0;i<_18.length;i++){_5.create("option",{innerHTML:_18[i],selected:this.rowsPerPage===_18[i],value:_18[i]},_19);}this._updateRowsPerPageOption();}else{if(!(_18&&_18.length)&&_19){_5.destroy(_19);this.paginationSizeSelect=null;this._paginationSizeChangeHandle.remove();}}},_setPageSizeOptions:function(_1b){this.pageSizeOptions=_1b&&_1b.sort(function(a,b){return a-b;});this._updatePaginationSizeSelect();},_updateRowsPerPageOption:function(){var _1c=this.rowsPerPage,_1d=this.pageSizeOptions,_1e=this.paginationSizeSelect;if(_1e){if(_3.indexOf(_1d,_1c)<0){this._setPageSizeOptions(_1d.concat([_1c]));}else{_1e.value=""+_1c;}}},_setRowsPerPage:function(_1f){this.rowsPerPage=_1f;this._updateRowsPerPageOption();this.gotoPage(1);},_updateNavigation:function(_20){var _21=this,_c=this.i18nPagination,_22=this.paginationLinksNode,_23=this._currentPage,_24=this.pagingLinks,_25=this.paginationNavigationNode,end=Math.ceil(_20/this.rowsPerPage),_26=this._pagingTextBoxHandle,_27=document.activeElement,_28,_29,_2a;function _2b(_2c,_2d){var _2e;var _2f;if(_21.pagingTextBox&&_2c===_23&&end>1){_2e=_5.create("input",{"aria-label":_c.jumpPage,className:"dgrid-page-input",type:"text",value:_23},_22);_21._pagingTextBoxHandle=on(_2e,"change",function(){var _30=+this.value;if(!isNaN(_30)&&_30>0&&_30<=end){_21.gotoPage(+this.value);}});if(_27&&_27.tagName==="INPUT"){_2e.focus();}}else{_2f=_2c===_23;_2e=_5.create("span",{"aria-label":_c.gotoPage,className:"dgrid-page-link"+(_2f?" dgrid-page-disabled":""),innerHTML:_2c+(_2d?" ":""),tabIndex:_2f?-1:0},_22);if(_28===_2c){if(!_2f){_2e.focus();}else{if(_2c<end){_28++;}else{_29.focus();}}}if(!_2f){_29=_2e;}}};function _31(_32,_33){_6.toggle(_32,"dgrid-page-disabled",_33);_32.tabIndex=_33?-1:0;};function _34(){_5.create("span",{className:"dgrid-page-skip",innerHTML:"..."},_22);};if(!_27||!_b.contains(this.paginationNavigationNode,_27)){_27=null;}else{if(_27.className==="dgrid-page-link"){_28=+_27.innerHTML;}}if(_26){_26.remove();}_22.innerHTML="";_7(".dgrid-first, .dgrid-previous",_25).forEach(function(_35){_31(_35,_23===1);});_7(".dgrid-last, .dgrid-next",_25).forEach(function(_36){_31(_36,_23>=end);});if(_24&&end>0){_2b(1,true);var _37=_23-_24;if(_37>2){_34();}else{_37=2;}for(var i=_37;i<Math.min(_23+_24+1,end);i++){_2b(i,true);}if(_23+_24+1<end){_34();}if(end>1){_2b(end);}}else{if(_21.pagingTextBox){_2b(_23);}}if(_27&&_27.tabIndex===-1){_2a=_7("[tabindex=\"0\"]",this.paginationNavigationNode);if(_27===this.paginationPreviousNode||_27===this.paginationFirstNode){_27=_2a[0];}else{if(_2a.length){_27=_2a[_2a.length-1];}}if(_27){_27.focus();}}},_updatePaginationStatus:function(_38){var _39=this.rowsPerPage;var _3a=Math.min(_38,(this._currentPage-1)*_39+1);this.paginationStatusNode.innerHTML=_8.substitute(this.i18nPagination.status,{start:_3a,end:Math.min(_38,_3a+_39-1),total:_38});},refresh:function(_3b){var _3c=this;var _3d=_3b&&_3b.keepCurrentPage?Math.min(this._currentPage,Math.ceil(this._total/this.rowsPerPage)):1;this.inherited(arguments);return this.gotoPage(_3d).then(function(_3e){setTimeout(function(){on.emit(_3c.domNode,"dgrid-refresh-complete",{bubbles:true,cancelable:false,grid:_3c});},0);return _3e;});},_onNotification:function(_3f,_40,_41){var _42=this.rowsPerPage;var _43=this._currentPage*_42;var _44=(_40.type==="add"&&_40.index<_43)||(_40.type==="delete"&&_40.previousIndex<_43)||(_40.type==="update"&&Math.floor(_40.index/_42)!==Math.floor(_40.previousIndex/_42));if(_44){this.gotoPage(Math.min(this._currentPage,Math.ceil(_40.totalLength/this.rowsPerPage)));}else{if(_41===this._renderedCollection&&_40.totalLength!==this._total){this._updatePaginationStatus(_40.totalLength);this._updateNavigation(_40.totalLength);}}},renderQueryResults:function(_45,_46){var _47=this,_48=this.inherited(arguments);if(!_46){if(this._topLevelRequest){this._topLevelRequest.cancel();delete this._topLevelRequest;}if(typeof _48.cancel==="function"){this._topLevelRequest=_48;}_48.then(function(){if(_47._topLevelRequest){delete _47._topLevelRequest;}});}return _48;},insertRow:function(){var _49=this._oldPageNodes,row=this.inherited(arguments);if(_49&&row===_49[row.id]){delete _49[row.id];}return row;},gotoPage:function(_4a){var _4b=this,_4c=(this._currentPage-1)*this.rowsPerPage;if(!this._renderedCollection){console.warn("Pagination requires a collection to operate.");return _a([]);}if(this._renderedCollection.releaseRange){this._renderedCollection.releaseRange(_4c,_4c+this.rowsPerPage);}return this._trackError(function(){var _4d=_4b.rowsPerPage,_4c=(_4a-1)*_4d,_4e={start:_4c,count:_4d},_4f,_50=_4b.contentNode,_51,_52,_53,i,len;if(_4b.showLoadingMessage){_d(_4b);_51=_4b.loadingNode=_5.create("div",{className:"dgrid-loading",innerHTML:_4b.loadingMessage},_50);}else{_4b._oldPageNodes=_52={};_53=_50.children;for(i=0,len=_53.length;i<len;i++){_52[_53[i].id]=_53[i];}}_4b._isLoading=true;_4f=_4b._renderedCollection.fetchRange({start:_4c,end:_4c+_4d});return _4b.renderQueryResults(_4f,null,_4e).then(function(_54){_f(_4b);_4b.scrollTo({y:0});if(_4b._rows){_4b._rows.min=_4c;_4b._rows.max=_4c+_4d-1;}_4f.totalLength.then(function(_55){if(!_55){if(_4b.noDataNode){_5.destroy(_4b.noDataNode);delete _4b.noDataNode;}_4b.noDataNode=_5.create("div",{className:"dgrid-no-data",innerHTML:_4b.noDataMessage},_4b.contentNode);}_4b._total=_55;_4b._currentPage=_4a;_4b._rowsOnPage=_54.length;_4b._updatePaginationStatus(_55);_4b._updateNavigation(_55);});return _4f;},function(_56){_f(_4b);throw _56;});});}});});