//>>built
define("dgrid/Selector",["dojo/_base/declare","dojo/_base/lang","dojo/_base/sniff","dojo/dom-construct","dojo/dom-class","./Selection"],function(_1,_2,_3,_4,_5,_6){return _1(_6,{postCreate:function(){this.inherited(arguments);this.on(".dgrid-selector:click,.dgrid-selector:keydown",_2.hitch(this,"_handleSelectorClick"));this.on("dgrid-select",_2.hitch(this,"_changeSelectorInput",true));this.on("dgrid-deselect",_2.hitch(this,"_changeSelectorInput",false));},_defaultRenderSelectorInput:function(_7,_8,_9,_a){var _b=_7.grid;_5.add(_9,"dgrid-selector");return _9.input||(_9.input=_4.create("input",{"aria-checked":_8,checked:_8,disabled:!_b.allowSelect(_b.row(_a)),tabIndex:isNaN(_7.tabIndex)?-1:_7.tabIndex,type:_7.selector},_9));},_configureSelectorColumn:function(_c){var _d=this;var _e=_c.selector;this._selectorColumns.push(_c);this._selectorSingleRow=this._selectorSingleRow||_c.selector==="radio";var _f=typeof _e==="function"?_e:this._defaultRenderSelectorInput;_c.sortable=false;_c.renderCell=function(_10,_11,_12){var row=_10&&_d.row(_10);_11=row&&_d.selection[row.id];_f(_c,!!_11,_12,_10);};_c.renderHeaderCell=function(th){var _13="label" in _c?_c.label:_c.field||"";if(_c.selector==="radio"||!_d.allowSelectAll){th.appendChild(document.createTextNode(_13));}else{_c._selectorHeaderCheckbox=_f(_c,false,th,{});_d._hasSelectorHeaderCheckbox=true;}};},_handleSelectorClick:function(_14){var _15=this.cell(_14);var row=_15.row;if(_14.type==="click"||_14.keyCode===32||(!_3("opera")&&_14.keyCode===13)||_14.keyCode===0){this._selectionTriggerEvent=_14;if(row){if(this.allowSelect(row)){var _16=this._lastSelected&&this.row(this._lastSelected);if(this._selectorSingleRow){if(!_16||_16.id!==row.id){this.clearSelection();this.select(row,null,true);this._lastSelected=row.element;}}else{if(row){if(_14.shiftKey){this._changeSelectorInput(true,{rows:[row]});}else{_16=null;}_16=_14.shiftKey?_16:null;this.select(_16||row,row,_16?undefined:null);this._lastSelected=row.element;}}}}else{this[this.allSelected?"clearSelection":"selectAll"]();}this._selectionTriggerEvent=null;}},_changeSelectorInput:function(_17,_18){if(this._selectorColumns.length){this._updateRowSelectors(_17,_18);}if(this._hasSelectorHeaderCheckbox){this._updateHeaderCheckboxes();}},_updateRowSelectors:function(_19,_1a){var _1b=_1a.rows;var _1c=_1b.length;var _1d=this._selectorColumns.length;for(var _1e=0;_1e<_1c;_1e++){for(var _1f=0;_1f<_1d;_1f++){var _20=this._selectorColumns[_1f];var _21=this.cell(_1b[_1e],_20.id).element;if(!_21){continue;}_21=(_21.contents||_21).input;if(_21&&!_21.disabled){_21.checked=_19;_21.setAttribute("aria-checked",_19);}}}},_updateHeaderCheckboxes:function(){var _22=this._selectorColumns.length;for(var _23=0;_23<_22;_23++){var _24=this._selectorColumns[_23];var _25="false";var _26;var _27;var _28=_24._selectorHeaderCheckbox;if(_28){_26=this.selection;_27=false;for(var i in _26){if(_26[i]!=this.allSelected){_27=true;break;}}_28.indeterminate=_27;_28.checked=this.allSelected;if(_27){_25="mixed";}else{if(this.allSelected){_25="true";}}_28.setAttribute("aria-checked",_25);}}},configStructure:function(){this.inherited(arguments);var _29=this.columns;this._selectorColumns=[];this._hasSelectorHeaderCheckbox=this._selectorSingleRow=false;for(var k in _29){if(_29[k].selector){this._configureSelectorColumn(_29[k]);}}},_handleSelect:function(_2a){var _2b=this.cell(_2a).column;if(!_2b||!_2b.selector){this.inherited(arguments);}}});});